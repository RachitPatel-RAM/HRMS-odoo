<!DOCTYPE html>
<html class="" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>HRMS Sign In</title>
    <link href="/css/output.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
    <style>
        @font-face {
            font-family: 'Gochi Hand';
            src: url('/fonts/gochi.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }
    </style>
</head>

<body
    class="bg-background-light min-h-screen flex items-center justify-center font-display transition-colors duration-300 p-4">
    <main
        class="w-full max-w-md bg-card-light border-2 border-black rounded-2xl shadow-hand p-8 md:p-12 relative overflow-hidden transform transition-all hover:rotate-1 duration-500">
        <div
            class="absolute -top-6 -right-6 w-24 h-24 bg-purple-100 rounded-full opacity-50 blur-xl pointer-events-none">
        </div>
        <div
            class="absolute -bottom-8 -left-8 w-32 h-32 bg-yellow-100 rounded-full opacity-50 blur-xl pointer-events-none">
        </div>
        <div class="flex justify-center mb-10">
            <div
                class="hand-border bg-gray-100 text-text-light px-8 py-4 w-full text-center relative group cursor-default select-none shadow-sm">
                <span class="text-2xl tracking-wide relative z-10 flex items-center justify-center gap-2">
                    <img src="/assets/logg_odooHRMS.png" alt="HRMS Portal" class="h-10 object-contain" />
                </span>
                <svg class="absolute bottom-2 left-1/2 -translate-x-1/2 w-24 h-2 stroke-primary opacity-60" fill="none"
                    viewbox="0 0 100 10" xmlns="http://www.w3.org/2000/svg">
                    <path d="M2 5C20 8 40 2 98 5" stroke-linecap="round" stroke-width="2"></path>
                </svg>
            </div>
        </div>
        <form class="space-y-6 relative z-10" id="loginForm">
            <!-- Error Message Container -->
            <div id="errorMessage"
                class="hidden w-full bg-red-100 border border-red-400 text-red-700 px-4 py-2 rounded relative text-center font-body text-xl"
                role="alert">
            </div>

            <div class="space-y-2">
                <label class="block text-xl ml-1" for="email">Employee ID / Email :-</label>
                <input
                    class="w-full bg-white border-2 border-black rounded-lg px-4 py-2 focus:ring-2 focus:ring-primary focus:border-primary outline-none transition-all placeholder-gray-400 shadow-sm"
                    id="email" name="email" placeholder="Employee ID or Email" type="text" required />
            </div>
            <div class="space-y-2">
                <label class="block text-xl text-text-light pl-1" for="password">
                    Password :-
                </label>
                <div class="relative">
                    <span
                        class="material-icons absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-xl">lock_outline</span>
                    <input
                        class="w-full pl-10 pr-4 py-3 bg-white border-2 border-black rounded-lg text-lg text-text-light placeholder-gray-400 hand-input transition-all shadow-sm focus:border-primary"
                        id="password" name="password" placeholder="••••••••" type="password" required />
                </div>
            </div>
            <div class="pt-4">
                <button
                    class="w-full bg-primary hover:bg-primary-hover text-white text-2xl py-3 px-6 border-2 border-black rounded-lg shadow-hand hover:shadow-hand-hover active:shadow-hand-active active:translate-x-[2px] active:translate-y-[2px] transition-all transform duration-150 uppercase tracking-wider"
                    type="submit">
                    Sign In
                </button>
            </div>
            <div class="text-center mt-8 pt-4 border-t-2 border-dashed border-gray-200">
                <p class="text-lg text-text-light">
                    Don't have an Account?
                    <a class="text-primary hover:text-purple-700 font-bold decoration-wavy underline decoration-2 underline-offset-4 transition-colors"
                        href="/index.html">
                        Sign Up
                    </a>
                </p>
                <p class="text-sm mt-4 text-gray-500">
                    &copy; 2026 odoo HRMS. All rights reserved
                </p>
            </div>
        </form>
    </main>

    <script>
        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.classList.remove('hidden');
        }

        // Auto-Redirect if logged in
        if (localStorage.getItem('token')) {
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            if (user.role === 'ADMIN' || user.role === 'HR') {
                window.location.href = '/admin-dashboard.html';
            } else {
                window.location.href = '/dashboard.html';
            }
        }

        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());

            // Reset error
            document.getElementById('errorMessage').classList.add('hidden');

            try {
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (response.ok) {
                    // Success 200
                    localStorage.setItem('token', result.token);
                    localStorage.setItem('user', JSON.stringify(result.user));

                    if (result.user.role === 'ADMIN' || result.user.role === 'HR') {
                        window.location.href = '/admin-dashboard.html';
                    } else {
                        window.location.href = '/dashboard.html';
                    }
                } else if (response.status === 423) {
                    // First Login
                    localStorage.setItem('token', result.token);
                    window.location.href = '/reset-password.html';
                } else {
                    showError(result.message || 'Login failed');
                }
            } catch (error) {
                console.error('Login error:', error);
                showError('An unexpected error occurred.');
            }
        });
    </script>
</body>

</html>