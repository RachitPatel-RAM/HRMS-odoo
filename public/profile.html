<!DOCTYPE html>
<html class="" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Employee My Profile - HRMS</title>
    <link href="/css/output.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Gochi+Hand&amp;family=Spline+Sans:wght@400;600&amp;display=swap"
        rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: "#9C27B0", // Purple accent
                        secondary: "#7B61FF",
                        "paper-white": "#FFFFFF",
                    },
                    fontFamily: {
                        hand: ["'Gochi Hand'", "cursive"],
                        display: ["'Gochi Hand'", "cursive"], // Unified font as requested
                    },
                    boxShadow: {
                        sketch: "4px 4px 0px 0px rgba(0,0,0,1)",
                        "sketch-sm": "2px 2px 0px 0px rgba(0,0,0,1)",
                        hand: "4px 4px 0px 0px rgba(0,0,0,1)",
                    }
                }
            }
        };
    </script>
    <style>
        @font-face {
            font-family: 'Gochi Hand';
            src: url('/fonts/gochi.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }

        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-left: 2px solid black;
        }

        ::-webkit-scrollbar-thumb {
            background: #9C27B0;
            border: 2px solid black;
            border-radius: 6px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #7B61FF;
        }

        .hand-input:focus {
            outline: none;
            border-color: #9C27B0;
            box-shadow: 0 0 0 2px rgba(156, 39, 176, 0.2);
        }
    </style>
</head>

<body class="bg-white text-gray-900 font-display min-h-screen flex flex-col selection:bg-purple-200">
    <!-- Navbar (Copied from Dashboard) -->
    <header
        class="sticky top-0 z-50 bg-white border-b-2 border-black w-full px-4 py-3 flex items-center justify-between shadow-sm">
        <div class="flex items-center gap-4">
            <div
                class="bg-primary text-white p-2 px-4 font-bold text-xl tracking-wider transform -rotate-1 flex items-center justify-center border-2 border-black shadow-[2px_2px_0px_0px_rgba(0,0,0,1)]">
                <img src="/assets/logg_odooHRMS.png" alt="HRMS Logo"
                    class="h-8 md:h-10 object-contain filter brightness-0 invert"
                    style="filter: none; filter: brightness(0) invert(1);" />
            </div>
        </div>
        <nav class="hidden md:flex items-center gap-4">
            <a class="bg-white px-6 py-2 text-lg transform hover:-rotate-1 hover:bg-gray-50 transition-all border-2 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]"
                href="/dashboard.html">
                Employees
            </a>
            <a class="bg-white px-6 py-2 text-lg transform hover:rotate-1 hover:bg-gray-50 transition-all border-2 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]"
                href="/attendance.html">
                Attendance
            </a>
            <a class="bg-white px-6 py-2 text-lg transform hover:-rotate-1 hover:bg-gray-50 transition-all border-2 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]"
                href="/timeoff.html">
                Time Off
            </a>
        </nav>
        <div class="flex items-center gap-4">
            <div class="relative group z-50">
                <button
                    class="w-10 h-10 rounded-full bg-gray-200 overflow-hidden border-2 border-black focus:outline-none focus:ring-2 focus:ring-primary block">
                    <img id="navAvatar" alt="User Avatar" class="w-full h-full object-cover"
                        src="https://ui-avatars.com/api/?name=User&background=random" />
                </button>
                <div
                    class="absolute right-0 mt-2 w-48 bg-white border-2 border-black rounded-md shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] opacity-0 group-hover:opacity-100 invisible group-hover:visible transition-all transform origin-top-right">
                    <a class="block px-4 py-2 text-lg hover:bg-purple-100" href="/profile.html">My Profile</a>
                    <a id="logoutBtn" class="block px-4 py-2 text-lg hover:bg-purple-100 cursor-pointer">Log Out</a>
                </div>
            </div>
            <button class="md:hidden p-2 text-gray-700" id="mobileMenuBtn">
                <span class="material-icons-outlined text-3xl">menu</span>
            </button>
        </div>
    </header>

    <!-- Mobile Menu -->
    <div id="mobileMenu" class="hidden md:hidden border-b-2 border-black bg-white p-4">
        <a class="block py-3 text-xl hover:text-primary hover:bg-gray-50 border-b border-gray-100"
            href="/dashboard.html">Employees</a>
        <a class="block py-3 text-xl hover:text-primary hover:bg-gray-50 border-b border-gray-100"
            href="#">Attendance</a>
        <a class="block py-3 text-xl hover:text-primary hover:bg-gray-50" href="#">Time Off</a>
    </div>


    <main class="flex-grow p-4 md:p-8 max-w-6xl mx-auto w-full">

        <section class="bg-white border-2 border-black rounded-lg p-6 mb-10 shadow-sketch relative">
            <header class="mb-6 pb-2 border-b-2 border-black/10">
                <h1 class="text-4xl font-bold text-black font-hand">My Profile</h1>
            </header>

            <div class="flex flex-col lg:flex-row gap-8 items-start">
                <div class="flex-shrink-0 relative mx-auto lg:mx-0">
                    <div class="w-40 h-40 rounded-full border-2 border-black overflow-hidden bg-gray-100 p-1">
                        <img id="profileImage" alt="Profile Picture"
                            class="w-full h-full object-cover rounded-full border border-gray-300"
                            src="https://ui-avatars.com/api/?name=User" />
                    </div>
                    <button id="editAvatarBtn" aria-label="Edit Profile Picture"
                        class="absolute bottom-2 right-2 bg-white text-black p-2 rounded-full border-2 border-black hover:bg-primary hover:text-white transition-colors shadow-sketch-sm">
                        <span class="material-icons-outlined text-xl block">edit</span>
                    </button>
                    <input type="file" id="avatarInput" class="hidden" accept="image/*">
                </div>
                <!-- Main Info Form -->
                <div class="flex-grow grid grid-cols-1 md:grid-cols-2 gap-6 w-full">
                    <div class="space-y-4">
                        <div class="group">
                            <label class="text-gray-600 text-lg block mb-1">Employee Name</label>
                            <input id="inputName"
                                class="w-full bg-white border-2 border-black rounded-lg px-3 py-2 text-xl font-bold focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent hand-input"
                                type="text" readonly />
                        </div>
                        <div class="group">
                            <label class="text-gray-600 text-lg block mb-1">Job Position</label>
                            <input id="inputDesignation"
                                class="w-full bg-gray-50 border-2 border-black rounded-lg px-3 py-2 text-lg focus:outline-none cursor-not-allowed"
                                type="text" readonly />
                        </div>
                        <div class="group">
                            <label class="text-gray-600 text-lg block mb-1">Work Email</label>
                            <input id="inputWorkEmail"
                                class="w-full bg-gray-50 border-2 border-black rounded-lg px-3 py-2 text-lg focus:outline-none cursor-not-allowed"
                                type="email" readonly />
                        </div>
                        <div class="group">
                            <label class="text-gray-600 text-lg block mb-1">Mobile Number</label>
                            <input id="inputMobile"
                                class="w-full bg-white border-2 border-black rounded-lg px-3 py-2 text-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent hand-input"
                                type="tel" />
                        </div>
                    </div>
                    <div class="space-y-4">
                        <div class="group">
                            <label class="text-gray-600 text-lg block mb-1">Company</label>
                            <input id="inputCompany"
                                class="w-full bg-gray-50 border-2 border-black rounded-lg px-3 py-2 text-lg focus:outline-none cursor-not-allowed"
                                type="text" readonly />
                        </div>
                        <div class="group">
                            <label class="text-gray-600 text-lg block mb-1">Department</label>
                            <input id="inputDepartment"
                                class="w-full bg-gray-50 border-2 border-black rounded-lg px-3 py-2 text-lg focus:outline-none cursor-not-allowed"
                                type="text" readonly />
                        </div>
                        <div class="group">
                            <label class="text-gray-600 text-lg block mb-1">Manager</label>
                            <input id="inputManager"
                                class="w-full bg-gray-50 border-2 border-black rounded-lg px-3 py-2 text-lg focus:outline-none cursor-not-allowed"
                                type="text" readonly />
                        </div>
                        <div class="group">
                            <label class="text-gray-600 text-lg block mb-1">Location</label>
                            <input id="inputLocation"
                                class="w-full bg-gray-50 border-2 border-black rounded-lg px-3 py-2 text-lg focus:outline-none cursor-not-allowed"
                                type="text" readonly />
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Tabs -->
        <div class="flex overflow-x-auto gap-4 mb-0 pb-0 px-1 hide-scrollbar border-b-2 border-black/10">
            <button id="btnTabPrivate" data-tab="private"
                class="tab-btn px-8 py-3 text-xl border-2 border-black bg-primary text-white rounded-t-lg relative z-10 shadow-[0_-4px_0_0_rgba(0,0,0,0.1)] border-b-0 -mb-[2px] font-bold">
                Private Info
            </button>
            <button id="btnTabSalary" data-tab="salary"
                class="tab-btn px-8 py-3 text-xl border-2 border-black bg-white text-black rounded-t-lg hover:bg-gray-100 transition-all translate-y-[2px] hover:translate-y-0 opacity-50 cursor-pointer">
                Salary Info
            </button>
            <button id="btnTabResume" data-tab="resume"
                class="tab-btn px-8 py-3 text-xl border-2 border-black bg-white text-black rounded-t-lg hover:bg-gray-100 transition-all translate-y-[2px] hover:translate-y-0 opacity-50 cursor-pointer">
                Resume
            </button>
        </div>

        <section
            class="bg-white border-2 border-black border-t-0 rounded-b-lg rounded-tr-lg p-6 md:p-10 shadow-sketch relative z-0">
            <!-- Private Info Form (Default) -->
            <form id="detailsForm" class="relative z-10 grid grid-cols-1 lg:grid-cols-2 gap-12">
                <!-- ... Existing Form Content kept as is in next blocks ... -->

                <!-- Salary Info Section (Hidden by Default) -->
                <div id="salarySection" class="hidden relative z-10 animate-fade-in space-y-8 font-hand text-xl">
                    <div
                        class="bg-purple-50 border-2 border-black rounded-lg p-6 flex flex-col md:flex-row justify-between items-center gap-6 shadow-sketch-sm">
                        <div class="text-center md:text-left">
                            <h3 class="text-2xl font-bold text-primary mb-1">Fixed Wage</h3>
                            <p class="text-gray-600 text-sm">Monthly Gross Breakdown</p>
                        </div>
                        <div class="flex gap-8 text-center">
                            <div>
                                <p class="text-gray-500 text-sm mb-1 uppercase tracking-wide font-display">Monthly</p>
                                <p id="salMonthly" class="text-3xl font-bold">₹ --</p>
                            </div>
                            <div>
                                <p class="text-gray-500 text-sm mb-1 uppercase tracking-wide font-display">Yearly</p>
                                <p id="salYearly" class="text-3xl font-bold">₹ --</p>
                            </div>
                        </div>
                    </div>

                    <div id="salaryContent">
                        <!-- Component Table -->
                        <div class="border-2 border-black rounded-lg overflow-hidden">
                            <div class="bg-gray-50 border-b-2 border-black p-4">
                                <h4 class="font-bold text-xl">Salary Breakdown</h4>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full text-left border-collapse">
                                    <thead class="bg-white border-b-2 border-black">
                                        <tr>
                                            <th class="p-4 border-r border-black/10">Component</th>
                                            <th class="p-4 border-r border-black/10">Computation</th>
                                            <th class="p-4 text-right">Amount</th>
                                        </tr>
                                    </thead>
                                    <tbody id="salComponentsBody" class="bg-white">
                                        <!-- JS Populated -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Deductions -->
                        <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div class="border-2 border-black rounded-lg p-6 relative">
                                <h4 class="font-bold text-xl mb-4 border-b-2 border-black/10 pb-2">Deductions (Employee)
                                </h4>
                                <div class="space-y-4">
                                    <div class="flex justify-between items-center">
                                        <span>Provident Fund (12%)</span>
                                        <span id="valPFEmployee" class="font-bold">₹ --</span>
                                    </div>
                                    <div class="flex justify-between items-center text-gray-500 text-sm">
                                        <span>Employer Contribution</span>
                                        <span id="valPFEmployer">₹ --</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span>Professional Tax</span>
                                        <span id="valPT" class="font-bold">₹ --</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Salary Summary -->
                            <div
                                class="bg-primary/5 border-2 border-black rounded-lg p-6 flex flex-col justify-center gap-4">
                                <div class="flex justify-between items-center text-gray-600">
                                    <span>Gross Salary</span>
                                    <span id="valGross" class="font-bold font-mono">₹ --</span>
                                </div>
                                <div class="flex justify-between items-center text-red-500">
                                    <span>Total Deductions</span>
                                    <span id="valDeductions" class="font-bold font-mono">- ₹ --</span>
                                </div>
                                <div class="h-px bg-black my-2"></div>
                                <div class="flex justify-between items-center text-2xl font-bold text-primary">
                                    <span>Net Pay</span>
                                    <span id="valNetPay" class="font-mono">₹ --</span>
                                </div>
                                <p class="text-center text-xs text-gray-400 mt-2 font-display">
                                    * This information is managed by HR and is read-only.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="space-y-6">
                    <div>
                        <label class="block text-xl mb-2 text-black font-bold">Date of Birth</label>
                        <div class="relative">
                            <input id="inputDOB"
                                class="w-full bg-white border-2 border-black rounded-lg px-4 py-3 text-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-shadow hand-input"
                                type="date" />
                        </div>
                    </div>
                    <div>
                        <label class="block text-xl mb-2 text-black font-bold">Residing Address</label>
                        <textarea id="inputAddress"
                            class="w-full bg-white border-2 border-black rounded-lg px-4 py-3 text-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-shadow hand-input"
                            rows="3"></textarea>
                    </div>
                    <div>
                        <label class="block text-xl mb-2 text-black font-bold">Nationality</label>
                        <input id="inputNationality"
                            class="w-full bg-white border-2 border-black rounded-lg px-4 py-3 text-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-shadow hand-input"
                            type="text" />
                    </div>
                    <div>
                        <label class="block text-xl mb-2 text-black font-bold">Personal Email</label>
                        <input id="inputPersonalEmail"
                            class="w-full bg-white border-2 border-black rounded-lg px-4 py-3 text-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-shadow hand-input"
                            type="email" />
                    </div>
                    <div class="grid grid-cols-2 gap-6">
                        <div>
                            <label class="block text-xl mb-2 text-black font-bold">Gender</label>
                            <select id="inputGender"
                                class="w-full bg-white border-2 border-black rounded-lg px-4 py-3 text-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-shadow hand-input">
                                <option value="">Select</option>
                                <option>Male</option>
                                <option>Female</option>
                                <option>Other</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xl mb-2 text-black font-bold">Marital Status</label>
                            <select id="inputMaritalStatus"
                                class="w-full bg-white border-2 border-black rounded-lg px-4 py-3 text-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-shadow hand-input">
                                <option value="">Select</option>
                                <option>Single</option>
                                <option>Married</option>
                                <option>Divorced</option>
                                <option>Widowed</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="block text-xl mb-2 text-black font-bold">Date of Joining</label>
                        <input id="inputDOJ"
                            class="w-full bg-gray-100 border-2 border-black/50 rounded-lg px-4 py-3 text-lg text-gray-500 cursor-not-allowed text-center"
                            disabled type="date" />
                    </div>
                </div>

                <!-- Bank Info -->
                <div class="space-y-6">
                    <div class="border-b-2 border-black pb-2 mb-6">
                        <h3 class="text-2xl font-bold flex items-center gap-2">
                            <span class="material-icons-outlined text-3xl">account_balance</span>
                            Bank Details
                        </h3>
                    </div>
                    <div>
                        <label class="block text-xl mb-2 text-black font-bold">Account Number</label>
                        <input id="inputAccountNumber"
                            class="w-full bg-white border-2 border-black rounded-lg px-4 py-3 text-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-shadow font-mono tracking-wider hand-input"
                            type="text" />
                    </div>
                    <div>
                        <label class="block text-xl mb-2 text-black font-bold">Bank Name</label>
                        <input id="inputBankName"
                            class="w-full bg-white border-2 border-black rounded-lg px-4 py-3 text-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-shadow hand-input"
                            type="text" />
                    </div>
                    <div>
                        <label class="block text-xl mb-2 text-black font-bold">IFSC Code</label>
                        <input id="inputIFSC"
                            class="w-full bg-white border-2 border-black rounded-lg px-4 py-3 text-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-shadow font-mono hand-input"
                            type="text" />
                    </div>
                    <div>
                        <label class="block text-xl mb-2 text-black font-bold">PAN No</label>
                        <input id="inputPAN"
                            class="w-full bg-white border-2 border-black rounded-lg px-4 py-3 text-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-shadow font-mono hand-input"
                            type="text" />
                    </div>
                    <div>
                        <label class="block text-xl mb-2 text-black font-bold">UAN No</label>
                        <input id="inputUAN"
                            class="w-full bg-white border-2 border-black rounded-lg px-4 py-3 text-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-shadow font-mono hand-input"
                            type="text" />
                    </div>
                </div>
                <div class="lg:col-span-2 flex justify-end mt-8 pt-6 border-t-2 border-black/10">
                    <button type="submit" id="saveBtn"
                        class="bg-primary hover:bg-[#7B1FA2] text-white text-xl py-3 px-12 rounded-lg shadow-sketch border-2 border-black transition-all transform active:scale-95 active:shadow-none font-bold tracking-wide">
                        Save Changes
                    </button>
                    <p id="saveMsg" class="ml-4 mt-4 text-green-600 font-bold hidden">Saved successfully!</p>
                </div>
            </form>
        </section>

        <!-- SALARY SECTION -->
        <section id="salarySection"
            class="bg-white dark:bg-card-dark rounded-lg shadow-sketch border-2 border-black p-6 md:p-8 hidden">
            <h2 class="text-3xl font-bold mb-6 flex items-center gap-3">
                <span class="material-icons-outlined text-4xl text-primary">payments</span>
                Salary Information
            </h2>

            <div id="salaryContent">
                <!-- Wage Summary -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                    <div class="bg-green-50 border-2 border-green-200 rounded-lg p-6 text-center">
                        <p class="text-gray-600 text-lg font-bold">Monthly Wage</p>
                        <p id="salMonthly" class="text-4xl font-bold text-green-700 mt-2">₹ --</p>
                    </div>
                    <div class="bg-blue-50 border-2 border-blue-200 rounded-lg p-6 text-center">
                        <p class="text-gray-600 text-lg font-bold">Annual CTC</p>
                        <p id="salYearly" class="text-4xl font-bold text-blue-700 mt-2">₹ --</p>
                    </div>
                </div>

                <!-- Earnings Table -->
                <div class="mb-8">
                    <h3 class="text-xl font-bold mb-4 border-b-2 border-black/10 pb-2">Earnings</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead>
                                <tr class="bg-gray-100 text-gray-600 uppercase text-sm">
                                    <th class="py-3 px-4 rounded-tl-lg">Component</th>
                                    <th class="py-3 px-4">Type</th>
                                    <th class="py-3 px-4 text-right rounded-tr-lg">Amount</th>
                                </tr>
                            </thead>
                            <tbody id="salComponentsBody">
                                <!-- JS Populated -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Deductions -->
                <div class="mb-8">
                    <h3 class="text-xl font-bold mb-4 border-b-2 border-black/10 pb-2">Deductions</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-red-50 p-4 rounded border border-red-100">
                            <p class="text-sm text-red-600 font-bold">EPF (Employee)</p>
                            <p id="valPFEmployee" class="text-xl font-bold">₹ --</p>
                        </div>
                        <div class="bg-red-50 p-4 rounded border border-red-100">
                            <p class="text-sm text-red-600 font-bold">EPF (Employer)</p>
                            <p id="valPFEmployer" class="text-xl font-bold">₹ --</p>
                        </div>
                        <div class="bg-red-50 p-4 rounded border border-red-100">
                            <p class="text-sm text-red-600 font-bold">Professional Tax</p>
                            <p id="valPT" class="text-xl font-bold">₹ --</p>
                        </div>
                    </div>
                </div>

                <!-- Totals -->
                <div
                    class="bg-gray-900 text-white rounded-lg p-6 grid grid-cols-1 md:grid-cols-3 gap-6 text-center md:text-left items-center shadow-lg">
                    <div>
                        <p class="text-gray-400 text-sm uppercase tracking-wider">Gross Salary</p>
                        <p id="valGross" class="text-2xl font-bold text-white">₹ --</p>
                    </div>
                    <div>
                        <p class="text-gray-400 text-sm uppercase tracking-wider">Total Deductions</p>
                        <p id="valDeductions" class="text-2xl font-bold text-red-300">₹ --</p>
                    </div>
                    <div class="bg-white/10 p-4 rounded-lg border border-white/20">
                        <p class="text-green-300 text-sm uppercase tracking-wider font-bold">Net Pay (Take Home)</p>
                        <p id="valNetPay" class="text-3xl font-bold text-white mt-1">₹ --</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- RESUME SECTION -->
        <section id="resumeSection"
            class="bg-white dark:bg-card-dark rounded-lg shadow-sketch border-2 border-black p-6 md:p-8 hidden space-y-8">
            <h2 class="text-3xl font-bold flex items-center gap-3">
                <span class="material-icons-outlined text-4xl text-primary">description</span>
                Resume & Skills
            </h2>

            <!-- Resume Upload -->
            <div
                class="bg-purple-50 border-2 border-dashed border-purple-200 rounded-lg p-6 flex flex-col items-center justify-center gap-4">
                <div class="flex items-center gap-4">
                    <label
                        class="cursor-pointer bg-primary text-white px-6 py-2 rounded-lg font-bold shadow-md hover:bg-purple-700 transition-colors">
                        Upload Resume (PDF)
                        <input id="resumeUploadInput" type="file" accept=".pdf" class="hidden" />
                    </label>
                    <a id="resumeDownloadLink" href="#" target="_blank"
                        class="hidden text-blue-600 font-bold hover:underline flex items-center gap-1">
                        <span class="material-icons-outlined">download</span> View Current
                    </a>
                </div>
                <p id="resumeFileStatus" class="text-gray-500 italic">No file uploaded.</p>
            </div>

            <!-- Summary -->
            <div>
                <h3 class="text-xl font-bold mb-2">Professional Summary</h3>
                <textarea id="resumeSummary" rows="4"
                    class="w-full bg-white border-2 border-black rounded-lg p-4 text-lg focus:ring-2 focus:ring-primary focus:outline-none"
                    placeholder="Brief summary of your expertise..."></textarea>
            </div>

            <!-- Experience -->
            <div>
                <div class="flex justify-between items-center mb-4 border-b-2 border-black/10 pb-2">
                    <h3 class="text-xl font-bold">Experience</h3>
                    <button id="btnAddExp"
                        class="text-primary font-bold hover:bg-purple-50 px-3 py-1 rounded flex items-center gap-1">
                        <span class="material-icons-outlined">add</span> Add
                    </button>
                </div>
                <div id="experienceList" class="space-y-4"></div>
            </div>

            <!-- Education -->
            <div>
                <div class="flex justify-between items-center mb-4 border-b-2 border-black/10 pb-2">
                    <h3 class="text-xl font-bold">Education</h3>
                    <button id="btnAddEdu"
                        class="text-primary font-bold hover:bg-purple-50 px-3 py-1 rounded flex items-center gap-1">
                        <span class="material-icons-outlined">add</span> Add
                    </button>
                </div>
                <div id="educationList" class="space-y-4"></div>
            </div>

            <!-- Skills & Certs Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Skills -->
                <div>
                    <div class="flex justify-between items-center mb-4 border-b-2 border-black/10 pb-2">
                        <h3 class="text-xl font-bold">Skills</h3>
                        <button id="btnAddSkill"
                            class="text-primary font-bold hover:bg-purple-50 px-3 py-1 rounded flex items-center gap-1">
                            <span class="material-icons-outlined">add</span> Add
                        </button>
                    </div>
                    <div id="skillsList" class="flex flex-wrap gap-2"></div>
                </div>

                <!-- Certifications -->
                <div>
                    <div class="flex justify-between items-center mb-4 border-b-2 border-black/10 pb-2">
                        <h3 class="text-xl font-bold">Certifications</h3>
                        <button id="btnAddCert"
                            class="text-primary font-bold hover:bg-purple-50 px-3 py-1 rounded flex items-center gap-1">
                            <span class="material-icons-outlined">add</span> Add
                        </button>
                    </div>
                    <div id="certList" class="space-y-3"></div>
                </div>
            </div>

            <div class="flex justify-end pt-6 border-t-2 border-black/10">
                <button id="btnSaveResume"
                    class="bg-primary text-white text-xl py-3 px-12 rounded-lg shadow-sketch border-2 border-black font-bold tracking-wide hover:bg-purple-700 transition-all flex items-center gap-2">
                    <span class="material-icons-outlined">save</span> Save Resume Profile
                </button>
            </div>
        </section>
    </main>
    <footer class="text-center py-6 text-gray-500 text-lg border-t-2 border-black mt-auto bg-white">
        © 2026 odoo HRMS - All Right Reserved.
    </footer>

    <script>
        const API_BASE = '/api';
        let currentProfile = {};

        async function fetchProfile() {
            const token = localStorage.getItem('token');
            if (!token) return window.location.href = '/login.html';

            try {
                const res = await fetch(`${API_BASE}/profile/me`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (res.status === 401) {
                    window.location.href = '/login.html';
                    return;
                }

                if (!res.ok) {
                    console.error('Failed to fetch profile:', res.status, res.statusText);
                    // Don't crash, but show empty state or alert
                    if (res.status === 404) {
                        alert("Profile not found. Please contact HR.");
                    }
                    return;
                }

                const data = await res.json();
                currentProfile = data;
                renderProfile(data);
            } catch (err) {
                console.error(err);
                alert("An error occurred while loading your profile.");
            }
        }

        function renderProfile(data) {
            // Safely access properties with optional chaining and null coalescing
            const fullName = (data.first_name || '') + ' ' + (data.last_name || '');
            document.getElementById('inputName').value = fullName.trim() || 'N/A';

            document.getElementById('inputDesignation').value = data.designation || '';
            document.getElementById('inputWorkEmail').value = data.User?.email || ''; // Use chained access for User
            document.getElementById('inputMobile').value = data.phone || '';
            document.getElementById('inputCompany').value = data.Company?.name || ''; // Use chained access for Company
            document.getElementById('inputDepartment').value = data.department || '';
            document.getElementById('inputManager').value = data.manager_name || '';
            document.getElementById('inputLocation').value = data.location || '';

            // Image
            const avatarUrl = data.profile_picture || "https://ui-avatars.com/api/?name=" + encodeURIComponent(fullName || 'User');
            document.getElementById('profileImage').src = avatarUrl;
            const navAvatar = document.getElementById('navAvatar');
            if (navAvatar) navAvatar.src = avatarUrl;


            // Tabs / Details
            const today = new Date().toISOString().split('T')[0];
            const dobInput = document.getElementById('inputDOB');
            dobInput.max = today; // Prevent future dates
            dobInput.value = data.date_of_birth || '';

            document.getElementById('inputAddress').value = data.address || '';
            document.getElementById('inputNationality').value = data.nationality || '';
            document.getElementById('inputPersonalEmail').value = data.personal_email || '';
            document.getElementById('inputGender').value = data.gender || '';
            document.getElementById('inputMaritalStatus').value = data.marital_status || '';
            document.getElementById('inputDOJ').value = data.date_of_joining || '';

            // Bank Details
            const bank = data.BankDetail || {};
            document.getElementById('inputAccountNumber').value = bank.account_number || '';
            document.getElementById('inputBankName').value = bank.bank_name || '';
            document.getElementById('inputIFSC').value = bank.ifsc_code || '';
            document.getElementById('inputPAN').value = bank.pan_number || '';
            document.getElementById('inputUAN').value = bank.uan_number || '';
        }

        document.getElementById('detailsForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const saveBtn = document.getElementById('saveBtn');
            saveBtn.disabled = true;
            saveBtn.innerText = 'Saving...';

            // Collect Data
            const updates = {
                phone: document.getElementById('inputMobile').value,
                date_of_birth: document.getElementById('inputDOB').value || null,
                address: document.getElementById('inputAddress').value,
                nationality: document.getElementById('inputNationality').value,
                personal_email: document.getElementById('inputPersonalEmail').value,
                gender: document.getElementById('inputGender').value,
                marital_status: document.getElementById('inputMaritalStatus').value,
                bank_details: {
                    account_number: document.getElementById('inputAccountNumber').value,
                    bank_name: document.getElementById('inputBankName').value,
                    ifsc_code: document.getElementById('inputIFSC').value,
                    pan_number: document.getElementById('inputPAN').value,
                    uan_number: document.getElementById('inputUAN').value
                }
            };

            const token = localStorage.getItem('token');
            try {
                const res = await fetch(`${API_BASE}/profile/me`, {
                    method: 'PUT',
                    headers: { 'Authorization': `Bearer ${token}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify(updates)
                });

                if (res.ok) {
                    const msg = document.getElementById('saveMsg');
                    msg.classList.remove('hidden');
                    setTimeout(() => msg.classList.add('hidden'), 3000);
                    // Refresh data to show updates
                    fetchProfile();
                } else {
                    const err = await res.json();
                    alert('Failed to save changes: ' + (err.message || 'Unknown error'));
                }
            } catch (err) {
                console.error(err);
                alert('Error saving data');
            } finally {
                saveBtn.disabled = false;
                saveBtn.innerText = 'Save Changes';
            }
        });

        // Avatar Upload
        const editAvatarBtn = document.getElementById('editAvatarBtn');
        if (editAvatarBtn) {
            editAvatarBtn.addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('avatarInput').click();
            });
        }

        const avatarInput = document.getElementById('avatarInput');
        if (avatarInput) {
            avatarInput.addEventListener('change', async (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const formData = new FormData();
                formData.append('avatar', file);

                const token = localStorage.getItem('token');
                try {
                    // Optimistic Update
                    const reader = new FileReader();
                    reader.onload = (e) => document.getElementById('profileImage').src = e.target.result;
                    reader.readAsDataURL(file);

                    const res = await fetch(`${API_BASE}/profile/avatar`, {
                        method: 'POST',
                        headers: { 'Authorization': `Bearer ${token}` },
                        body: formData
                    });

                    if (!res.ok) {
                        const err = await res.json();
                        throw new Error(err.message || 'Upload status ' + res.status);
                    }

                    const data = await res.json();
                    if (!data.url) throw new Error('No URL returned');
                    // Success
                } catch (err) {
                    console.error("Avatar Upload Error:", err);
                    alert('Upload failed: ' + err.message);
                }
            });
        }

        const logoutBtn = document.getElementById('logoutBtn');
        if (logoutBtn) {
            logoutBtn.addEventListener('click', () => {
                localStorage.removeItem('token');
                window.location.href = '/login.html';
            });
        }

        const btnTabPrivate = document.getElementById('btnTabPrivate');
        if (btnTabPrivate) {
            btnTabPrivate.addEventListener('click', () => switchTab('private'));
        }

        const btnTabSalary = document.getElementById('btnTabSalary');
        if (btnTabSalary) {
            btnTabSalary.addEventListener('click', () => switchTab('salary'));
        }

        const btnTabResume = document.getElementById('btnTabResume');
        if (btnTabResume) {
            btnTabResume.addEventListener('click', () => switchTab('resume'));
        }

        // Tab Switching
        function switchTab(tabName) {
            // Update Buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                if (btn.dataset.tab === tabName) {
                    btn.classList.remove('bg-white', 'text-black', 'border-b-2', 'translate-y-[2px]', 'opacity-50', 'cursor-pointer');
                    btn.classList.add('bg-primary', 'text-white', 'shadow-[0_-4px_0_0_rgba(0,0,0,0.1)]', 'border-b-0', '-mb-[2px]', 'font-bold', 'z-10');
                } else {
                    btn.classList.add('bg-white', 'text-black', 'border-b-2', 'translate-y-[2px]', 'opacity-50', 'cursor-pointer');
                    btn.classList.remove('bg-primary', 'text-white', 'shadow-[0_-4px_0_0_rgba(0,0,0,0.1)]', 'border-b-0', '-mb-[2px]', 'font-bold', 'z-10');
                }
            });

            // Show Section
            const detailsForm = document.getElementById('detailsForm');
            const salarySection = document.getElementById('salarySection');
            const resumeSection = document.getElementById('resumeSection');

            detailsForm.classList.add('hidden');
            if (salarySection) salarySection.classList.add('hidden');
            if (resumeSection) resumeSection.classList.add('hidden');

            if (tabName === 'private') {
                detailsForm.classList.remove('hidden');
            } else if (tabName === 'salary') {
                if (salarySection) {
                    salarySection.classList.remove('hidden');
                    fetchSalary();
                }
            } else if (tabName === 'resume') {
                if (resumeSection) {
                    resumeSection.classList.remove('hidden');
                    fetchResume();
                }
            }
        }

        /* --- Resume Logic --- */
        let resumeData = {
            experiences: [],
            educations: [],
            skills: [],
            certifications: []
        };

        async function fetchResume() {
            const token = localStorage.getItem('token');
            try {
                const res = await fetch(`${API_BASE}/resume/me`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                if (!res.ok) throw new Error('Failed to load resume');
                resumeData = await res.json();
                renderResume();
            } catch (e) {
                console.error(e);
            }
        }

        function renderResume() {
            // file
            const status = document.getElementById('resumeFileStatus');
            const dlLink = document.getElementById('resumeDownloadLink');
            if (resumeData.resume_file && resumeData.resume_file.file_url) {
                status.innerText = `Uploaded: ${resumeData.resume_file.file_name}`;
                dlLink.href = resumeData.resume_file.file_url;
                dlLink.classList.remove('hidden');
            } else {
                status.innerText = 'No file uploaded.';
                dlLink.classList.add('hidden');
            }

            // summary
            document.getElementById('resumeSummary').value = resumeData.summary || '';

            // experiences
            renderList('experienceList', resumeData.experiences, renderExperienceItem);
            // educations
            renderList('educationList', resumeData.educations, renderEducationItem);
            // skills
            renderList('skillsList', resumeData.skills, renderSkillItem);
            // certs
            renderList('certList', resumeData.certifications, renderCertItem);
        }

        function renderList(containerId, list, renderer) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            list.forEach((item, index) => {
                container.insertAdjacentHTML('beforeend', renderer(item, index));
            });
            // Re-attach delete listeners
            container.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const idx = e.target.closest('.delete-btn').dataset.index;
                    const type = e.target.closest('.delete-btn').dataset.type;
                    removeItem(type, idx);
                });
            });
        }

        function renderExperienceItem(exp, index) {
            return `
                <div class="border-2 border-black rounded-lg p-4 bg-gray-50 flex justify-between items-start relative group">
                    <div>
                        <h4 class="font-bold text-lg">${exp.title}</h4>
                        <p class="text-primary font-bold">${exp.company_name}</p>
                        <p class="text-sm text-gray-500">${exp.start_date} - ${exp.end_date || 'Present'}</p>
                        <p class="mt-2 text-gray-700">${exp.description || ''}</p>
                    </div>
                    <button class="delete-btn text-red-500 font-bold opacity-100 md:opacity-0 group-hover:opacity-100 transition-opacity" data-type="experiences" data-index="${index}">
                        <span class="material-icons-outlined">delete</span>
                    </button>
                    <!-- Inputs hidden or could be editable. For simplicity, we just render view and use add to add new.
                         Ideally we would bind inputs to these values for editing. 
                         Let's keep it simple: Add Item opens a modal/prompt? 
                         OR better: Render as Inputs directly since user wants to edit. -->
                 </div>
            `;
        }

        // Re-thinking: The requirement allows "manage/update". Rendering static text makes editing hard.
        // Let's render INPUTS for everything? Or just keep it as JSON state manipulation.
        // Given complexity, let's render Input Fields directly in the list so they can type.
        // Wait, "Delete" removes from ARRAY. "Save" sends entire array.

        function removeItem(type, index) {
            resumeData[type].splice(index, 1);
            renderResume();
        }

        function renderExperienceItem(exp, index) {
            return `
                <div class="border-2 border-black rounded-lg p-4 bg-gray-50 space-y-3 relative">
                    <button class="delete-btn absolute top-2 right-2 text-red-500" data-type="experiences" data-index="${index}"><span class="material-icons-outlined">delete</span></button>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold text-gray-500 uppercase">Job Title</label>
                            <input type="text" value="${exp.title}" placeholder="e.g. Software Engineer" class="bg-white border text-lg p-2 rounded w-full" onchange="updateItem('experiences', ${index}, 'title', this.value)">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-500 uppercase">Company</label>
                            <input type="text" value="${exp.company_name}" placeholder="e.g. Google" class="bg-white border text-lg p-2 rounded w-full" onchange="updateItem('experiences', ${index}, 'company_name', this.value)">
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold text-gray-500 uppercase">Start Date</label>
                            <input type="date" value="${exp.start_date}" class="bg-white border p-2 rounded w-full" onchange="updateItem('experiences', ${index}, 'start_date', this.value)">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-500 uppercase">End Date</label>
                            <input type="date" value="${exp.end_date}" class="bg-white border p-2 rounded w-full" onchange="updateItem('experiences', ${index}, 'end_date', this.value)">
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase">Description</label>
                        <textarea placeholder="Brief description of your role..." rows="2" class="w-full bg-white border p-2 rounded" onchange="updateItem('experiences', ${index}, 'description', this.value)">${exp.description || ''}</textarea>
                    </div>
                </div>
             `;
        }

        function renderEducationItem(edu, index) {
            return `
                <div class="border-2 border-black rounded-lg p-4 bg-gray-50 space-y-3 relative">
                     <button class="delete-btn absolute top-2 right-2 text-red-500" data-type="educations" data-index="${index}"><span class="material-icons-outlined">delete</span></button>
                     <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <input type="text" value="${edu.degree}" placeholder="Degree" class="bg-white border text-lg p-2 rounded w-full" onchange="updateItem('educations', ${index}, 'degree', this.value)">
                        <input type="text" value="${edu.institution_name}" placeholder="Institution" class="bg-white border text-lg p-2 rounded w-full" onchange="updateItem('educations', ${index}, 'institution_name', this.value)">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <input type="number" value="${edu.completion_year}" placeholder="Year" class="bg-white border p-2 rounded w-full" onchange="updateItem('educations', ${index}, 'completion_year', this.value)">
                        <input type="text" value="${edu.grade || ''}" placeholder="Grade/Percentage" class="bg-white border p-2 rounded w-full" onchange="updateItem('educations', ${index}, 'grade', this.value)">
                    </div>
                </div>
             `;
        }

        function renderSkillItem(skill, index) {
            return `
                 <div class="border-2 border-black rounded-full px-4 py-2 bg-purple-100 flex items-center gap-2 shadow-sm">
                     <input type="text" value="${skill.skill_name}" class="bg-transparent border-b border-black w-32 font-bold focus:outline-none placeholder-gray-500" placeholder="Skill Name" onchange="updateItem('skills', ${index}, 'skill_name', this.value)">
                     <select class="bg-transparent text-sm font-medium focus:outline-none cursor-pointer" onchange="updateItem('skills', ${index}, 'proficiency', this.value)">
                        <option value="Beginner" ${skill.proficiency === 'Beginner' ? 'selected' : ''}>Beginner</option>
                        <option value="Intermediate" ${skill.proficiency === 'Intermediate' ? 'selected' : ''}>Intermediate</option>
                        <option value="Advanced" ${skill.proficiency === 'Advanced' ? 'selected' : ''}>Advanced</option>
                     </select>
                     <button class="delete-btn text-red-500 hover:text-red-700 ml-1" data-type="skills" data-index="${index}">
                        <span class="material-icons-outlined text-lg">close</span>
                     </button>
                 </div>
             `;
        }

        function renderCertItem(cert, index) {
            return `
                 <div class="border-2 border-black rounded-lg p-4 bg-gray-50 space-y-2 relative">
                     <button class="delete-btn absolute top-2 right-2 text-red-500" data-type="certifications" data-index="${index}"><span class="material-icons-outlined">delete</span></button>
                     <input type="text" value="${cert.certification_name}" placeholder="Certificate Name" class="font-bold bg-white border p-1 rounded w-full" onchange="updateItem('certifications', ${index}, 'certification_name', this.value)">
                     <div class="grid grid-cols-2 gap-2">
                        <input type="text" value="${cert.organization || ''}" placeholder="Issuing Org" class="bg-white border p-1 rounded w-full" onchange="updateItem('certifications', ${index}, 'organization', this.value)">
                        <input type="number" value="${cert.year || ''}" placeholder="Year" class="bg-white border p-1 rounded w-full" onchange="updateItem('certifications', ${index}, 'year', this.value)">
                     </div>
                 </div>
            `;
        }

        window.updateItem = function (type, index, field, value) {
            resumeData[type][index][field] = value;
        };

        // Add Listeners
        const btnAddExp = document.getElementById('btnAddExp');
        if (btnAddExp) {
            btnAddExp.addEventListener('click', () => {
                resumeData.experiences.unshift({ title: '', company_name: '', start_date: '', end_date: '', description: '' });
                renderResume();
            });
        }

        const btnAddEdu = document.getElementById('btnAddEdu');
        if (btnAddEdu) {
            btnAddEdu.addEventListener('click', () => {
                resumeData.educations.unshift({ degree: '', institution_name: '', completion_year: new Date().getFullYear(), grade: '' });
                renderResume();
            });
        }

        const btnAddSkill = document.getElementById('btnAddSkill');
        if (btnAddSkill) {
            btnAddSkill.addEventListener('click', () => {
                resumeData.skills.push({ skill_name: 'New Skill', proficiency: 'Intermediate' });
                renderResume();
            });
        }

        const btnAddCert = document.getElementById('btnAddCert');
        if (btnAddCert) {
            btnAddCert.addEventListener('click', () => {
                resumeData.certifications.unshift({ certification_name: '', organization: '', year: new Date().getFullYear() });
                renderResume();
            });
        }

        // Save Resume
        const btnSaveResume = document.getElementById('btnSaveResume');
        if (btnSaveResume) {
            btnSaveResume.addEventListener('click', async () => {
                const summary = document.getElementById('resumeSummary').value;
                const payload = {
                    summary,
                    experiences: resumeData.experiences,
                    educations: resumeData.educations,
                    skills: resumeData.skills,
                    certifications: resumeData.certifications
                };

                const btn = document.getElementById('btnSaveResume');
                btn.innerText = 'Saving...';
                btn.disabled = true;

                try {
                    const token = localStorage.getItem('token');
                    const res = await fetch(`${API_BASE}/resume/me`, {
                        method: 'PUT',
                        headers: { 'Authorization': `Bearer ${token}`, 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (!res.ok) throw new Error('Save failed');
                    const data = await res.json();
                    resumeData = data; // Sync
                    renderResume();
                    alert('Resume Profile Saved!');
                } catch (e) {
                    alert('Error saving resume');
                } finally {
                    btn.innerText = 'Save Resume Profile';
                    btn.innerHTML = '<span class="material-icons-outlined">save</span> Save Resume Profile';
                    btn.disabled = false;
                }
            });
        }

        // Upload Resume
        const resumeInput = document.getElementById('resumeUploadInput');
        if (resumeInput) {
            resumeInput.addEventListener('change', async (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const formData = new FormData();
                formData.append('resume', file);

                const token = localStorage.getItem('token');
                try {
                    const status = document.getElementById('resumeFileStatus');
                    status.innerText = 'Uploading...';

                    const res = await fetch(`${API_BASE}/resume/me/upload`, {
                        method: 'POST',
                        headers: { 'Authorization': `Bearer ${token}` },
                        body: formData
                    });

                    if (!res.ok) throw new Error('Upload failed');
                    const data = await res.json(); // returns created record

                    // Update UI manually
                    resumeData.resume_file = data;
                    renderResume();
                    alert('Resume File Uploaded!');
                } catch (err) {
                    console.error("Resume Upload Error:", err);
                    alert('Upload failed: ' + err.message);
                }
            });
        }

        async function fetchSalary() {
            const token = localStorage.getItem('token');
            try {
                const res = await fetch(`${API_BASE}/salary/me`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (!res.ok) {
                    if (res.status === 404) {
                        document.getElementById('salaryContent').innerHTML = '<div class="text-center p-8 bg-gray-50 border-2 border-black border-dashed rounded-lg"><p class="text-xl font-bold">Salary information not available yet.</p><p class="text-sm text-gray-500">Contact HR to update your records.</p></div>';
                        return;
                    }
                    throw new Error('Failed to load salary');
                }

                const data = await res.json();
                renderSalary(data);
            } catch (e) {
                console.error(e);
                document.getElementById('salaryContent').innerHTML = '<p class="text-center text-red-500 text-xl">Error loading salary info. Please contact HR.</p>';
            }
        }

        function renderSalary(wrapper) {
            if (!wrapper || !wrapper.exists || !wrapper.data) {
                document.getElementById('salaryContent').innerHTML = '<p class="text-center p-4">Salary details not found.</p>';
                return;
            }
            const data = wrapper.data; // Extract actual data

            // Populate Wage Summary
            document.getElementById('salMonthly').innerText = '₹ ' + parseFloat(data.wage).toLocaleString('en-IN');
            document.getElementById('salYearly').innerText = '₹ ' + (parseFloat(data.wage) * 12).toLocaleString('en-IN');

            // Components Table
            const tbody = document.getElementById('salComponentsBody');
            tbody.innerHTML = '';

            const comps = [
                { name: 'Basic Salary', type: 'Earnings', val: data.basic_salary },
                { name: 'HRA', type: 'Earnings', val: data.hra },
                { name: 'Standard Allowance', type: 'Earnings', val: data.standard_allowance },
                { name: 'Performance Bonus', type: 'Earnings', val: data.performance_bonus },
                { name: 'LTA', type: 'Earnings', val: data.lta },
                { name: 'Fixed Allowance', type: 'Balancing Component', val: data.fixed_allowance },
            ];

            let gross = 0;
            comps.forEach(c => {
                const val = parseFloat(c.val || 0);
                gross += val;
                const row = `
                    <tr class="border-b border-black/10 hover:bg-purple-50 transition-colors">
                        <td class="py-3 px-4 font-bold">${c.name}</td>
                        <td class="py-3 px-4 text-gray-600">${c.type}</td>
                        <td class="py-3 px-4 text-right font-mono text-lg font-bold">₹ ${val.toLocaleString('en-IN')}</td>
                    </tr>
                 `;
                tbody.insertAdjacentHTML('beforeend', row);
            });

            // Deductions
            const pfEmp = parseFloat(data.pf_employee || 0);
            const pt = parseFloat(data.professional_tax || 0);
            const totalDeductions = pfEmp + pt;

            document.getElementById('valPFEmployee').innerText = '₹ ' + pfEmp.toLocaleString('en-IN');
            document.getElementById('valPFEmployer').innerText = '₹ ' + parseFloat(data.pf_employer || 0).toLocaleString('en-IN');
            document.getElementById('valPT').innerText = '₹ ' + pt.toLocaleString('en-IN');

            // Footer
            const netPay = gross - totalDeductions;

            document.getElementById('valGross').innerText = '₹ ' + gross.toLocaleString('en-IN');
            document.getElementById('valDeductions').innerText = '₹ ' + totalDeductions.toLocaleString('en-IN');
            document.getElementById('valNetPay').innerText = '₹ ' + netPay.toLocaleString('en-IN');
        }

        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        if (mobileMenuBtn) {
            mobileMenuBtn.addEventListener('click', () => {
                document.getElementById('mobileMenu').classList.toggle('hidden');
            });
        }

        fetchProfile();
    </script>
</body>

</html>