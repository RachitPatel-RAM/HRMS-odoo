<!DOCTYPE html>
<html class="" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Reset Password - HRMS</title>
    <!-- Local Font Registration -->
    <style>
        @font-face {
            font-family: 'Gochi Hand';
            src: url('/fonts/GochiHand-Regular.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }

        .font-gochi {
            font-family: "Gochi Hand", cursive;
        }
    </style>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
    <script>tailwind.config = { darkMode: "class", theme: { extend: { colors: { primary: "#9C27B0", "primary-hover": "#6447e8", "background-light": "#f8f6f8", "background-dark": "#1e131f", "card-light": "#FFFFFF", "card-dark": "#27272A", "border-dark": "#3F3F46", "text-light": "#1F2937", "text-dark": "#E4E4E7" }, fontFamily: { display: "Space Grotesk", body: ["'Gochi Hand'", "cursive"] }, borderRadius: { DEFAULT: "0.5rem", lg: "1rem", xl: "1.5rem", full: "9999px" }, boxShadow: { hand: "2px 3px 0px 0px rgba(0,0,0,1)", "hand-hover": "4px 5px 0px 0px rgba(0,0,0,1)", "hand-active": "1px 1px 0px 0px rgba(0,0,0,1)" } } } };</script>
    <style>
        .gochi-hand-regular {
            font-family: "Gochi Hand", cursive;
            font-weight: 400;
            font-style: normal;
        }

        body {
            background-image: radial-gradient(#e5e7eb 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .dark body {
            background-image: radial-gradient(#374151 1px, transparent 1px);
        }

        .hand-border {
            border: 2px solid black;
            border-radius: 255px 15px 225px 15px / 15px 225px 15px 255px;
        }

        .dark .hand-border {
            border-color: #E4E4E7;
        }

        .hand-input:focus {
            outline: none;
            box-shadow: 0 0 0 2px #c4b5fd;
            border-color: #7B61FF;
        }
    </style>
</head>

<body
    class="bg-background-light dark:bg-background-dark min-h-screen flex items-center justify-center font-display transition-colors duration-300 p-4">
    <main
        class="w-full max-w-md bg-card-light dark:bg-card-dark border-2 border-black dark:border-gray-200 rounded-2xl shadow-hand p-8 md:p-12 relative overflow-hidden transform transition-all hover:rotate-1 duration-500">
        <div
            class="absolute -top-6 -right-6 w-24 h-24 bg-purple-100 dark:bg-purple-900/30 rounded-full opacity-50 blur-xl pointer-events-none">
        </div>
        <div
            class="absolute -bottom-8 -left-8 w-32 h-32 bg-yellow-100 dark:bg-yellow-900/30 rounded-full opacity-50 blur-xl pointer-events-none">
        </div>

        <div class="flex justify-center mb-10">
            <div
                class="hand-border bg-gray-100 dark:bg-gray-800 text-text-light dark:text-text-dark px-8 py-4 w-full text-center relative group cursor-default select-none shadow-sm">
                <span class="text-2xl tracking-wide relative z-10 flex items-center justify-center gap-2">
                    <img src="/assets/logg_odooHRMS.png" alt="HRMS Portal" class="h-10 object-contain" />
                </span>
            </div>
        </div>

        <h2 class="text-2xl text-center mb-6 font-bold text-text-light dark:text-text-dark">Reset Password</h2>
        <p class="text-center mb-4 text-gray-600 dark:text-gray-400">Please set a new password for your account.</p>

        <form class="space-y-6 relative z-10" id="resetForm">
            <div class="space-y-2">
                <label class="block text-xl text-text-light dark:text-text-dark pl-1" for="newPassword">
                    New Password :-
                </label>
                <div class="relative">
                    <span
                        class="material-icons absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 dark:text-gray-500 text-xl">lock_outline</span>
                    <input
                        class="w-full pl-10 pr-4 py-3 bg-white dark:bg-gray-800 border-2 border-black dark:border-gray-300 rounded-lg text-lg text-text-light dark:text-text-dark placeholder-gray-400 dark:placeholder-gray-500 hand-input transition-all shadow-sm focus:border-primary dark:focus:border-primary"
                        id="newPassword" name="newPassword" placeholder="Min 8 chars, A-Z, 0-9, special" type="password"
                        required />
                </div>
            </div>

            <div class="pt-4">
                <button
                    class="w-full bg-primary hover:bg-primary-hover text-white text-2xl py-3 px-6 border-2 border-black dark:border-white rounded-lg shadow-hand hover:shadow-hand-hover active:shadow-hand-active active:translate-x-[2px] active:translate-y-[2px] transition-all transform duration-150 uppercase tracking-wider"
                    type="submit">
                    Update Password
                </button>
            </div>
        </form>
    </main>

    <script>
        document.getElementById('resetForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());
            const token = localStorage.getItem('token');

            if (!token) {
                alert('Session expired. Please login again.');
                window.location.href = '/login.html';
                return;
            }

            try {
                const response = await fetch('/api/auth/reset-password', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ newPassword: data.newPassword })
                });

                const result = await response.json();

                if (response.ok) {
                    alert('Password updated successfully! Please login again with your new password.');
                    localStorage.removeItem('token');
                    window.location.href = '/login.html';
                } else {
                    alert('Error: ' + result.message);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('An error occurred.');
            }
        });

        // Dark mode logic (if user toggles system pref or if we persist it)
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark')
        } else {
            document.documentElement.classList.remove('dark')
        }
    </script>
</body>

</html>